---
title: Confirm Login
layout: layouts/simple-layout.njk
---

<h1>
  Confirm Login
</h1>
<p>
  Hang on a moment while we confirm your login.
</p>
<div class="stack" data-different-device hidden>
  <p>
    It appears you opened this link on a different device than the one you
    originally wanted to log in with. We will need to confirm your email address
    before logging you in on this device. If you want to log in on your original
    device, close this tab and open the link on that device.
  </p>
  <form class="stack">
    <div>
      <label for="email">
        Email
      </label>
      <input id="email" type="email" name="email" style="width: 50ch">
    </div>
    <div>
      <button type="submit">
        Confirm Email
      </button>
    </div>
  </form>
</div>
<div data-login-error hidden>
  <p>
    We were unable to log you in. Either your email was invalid or the login
    link was invalid or had expired.
  </p>
</div>

{% include "scripts/firebase.njk" %}
<script>
  (() => {
    if (firebase.auth().isSignInWithEmailLink(window.location.href)) {
      const email = localStorage.getItem('emailForSignIn');
      if (!email) {
        const differentDeviceBlock = document.querySelector('[data-different-device]');
        differentDeviceBlock.removeAttribute('hidden');
        return;
      }

      firebase.auth().signInWithEmailLink(email, window.location.href)
        .then((result) => {
          localStorage.removeItem('emailForSignIn');
          window.location.href = '/overview';
        })
        .catch((error) => {
          const errorMessage = document.querySelector('[data-login-error]');
          errorMessage.removeAttribute('hidden');
        });
    }
  })();

  document.addEventListener('submit', (event) => {
    event.preventDefault();
    if (firebase.auth().isSignInWithEmailLink(window.location.href)) {
      const email = event.target.elements.email.value;

      firebase.auth().signInWithEmailLink(email, window.location.href)
        .then((result) => {
          window.location.href = '/overview';
        })
        .catch((error) => {
          const errorMessage = document.querySelector('[data-login-error]');
          errorMessage.removeAttribute('hidden');
        });
    }
  });
</script>
