---
title: Insights
layout: layouts/simple-layout.njk
---

<h1>
  Insights
</h1>

<p>
  Here are the key takeaways from your entire backlog of data. Keep in mind that
  this is not financial advice, and assumptions factor heavily into the
  calculations that drive these estimates.
</p>

{% include "components/back-link.njk" %}

<div data-progress-chart class="stack" hidden>
  <h2>
    Progress Chart
  </h2>
  <p>
    This is your progress chart. It shows your expenses and income along with
    the amount that you could safely withdraw each month (assuming you spend no
    more than 4% of your total savings per year and your savings are invested).
  </p>
  <p>
    Once the safe withdrawal amount is consistently higher than expenses, you
    have "enough" and could consider retirement.
  </p>
</div>

<div data-runway class="stack" hidden>
  <h2>
    Runway
  </h2>
  <p>
    Your runway is how long you could survive off of savings with no income.
    This is a simplified number that doesn't consider taxes, insurance, or other
    real-world things that would happen during unemployment, but it's meant to
    give a rough idea of how well-prepared you are to go without income for
    whatever reason.
  </p>
</div>

<div data-retirement class="stack" hidden>
  <h2>
    Retirement
  </h2>
  <div data-retirement-amount class="stack"></div>
  <div data-retirement-years class="stack"></div>
</div>

<div data-rolling-savings-rate class="stack" hidden>
  <h2>
    Savings Rate
  </h2>
  <p>
    Your savings rate is an indicator of how much money you saved compared to
    your total income. This chart breaks it down by month and shows rolling
    averages over different time scales.
  </p>
</div>

{% include "scripts/format-currency.njk" %}
<script type="module">
  import { getAllFromObjectStore } from '/scripts/db.mjs';

  const formatMonthString = (year, month) => new Date(year, month, 1)
    .toLocaleString('en-US', {
      month: 'short',
      year: 'numeric',
    });
  const sortingFunction = (a, b) => {
    if (a.year < b.year) {
      return -1;
    }

    if (a.year > b.year) {
      return 1;
    }

    if (a.month < b.month) {
      return -1;
    }

    if (a.month > b.month) {
      return 1;
    }

    return 0;
  };

  const runwayDescription = (numberOfMonths, recentMonthsCount) => {
    const years = Math.floor(numberOfMonths / 12);
    const months = numberOfMonths % 12;

    let yearPhrase = '';
    if (years === 1) {
      yearPhrase = '1 year';
    } else if (years > 1) {
      yearPhrase = `${years} years`;
    }

    let monthPhrase = '';
    if (months === 1) {
      monthPhrase = '1 month';
    } else if (months > 1) {
      monthPhrase = `${months} months`;
    }

    return `
      <p>
        Based on your current savings and your average expenses from the past
        ${recentMonthsCount === 1 ? 'month' : `${recentMonthsCount} months`},
        we estimate that your runway is
        <b>
          ${yearPhrase}${yearPhrase && monthPhrase ? ' and ' : ''}${monthPhrase}.
        </b>
      </p>
    `;
  };

  const calculateRunway = (totalExpensesByMonth, totalSavingsByMonth) => {
    const runwayBlock = document.querySelector('[data-runway]');
    const recentExpenses = totalExpensesByMonth.slice(-13, -1);
    if (!recentExpenses.length) {
      runwayBlock.innerHTML += `
        <p>
          We don't have enough expenses data to calculate what your runway might
          be. As a rule, we don't factor in the current month for this
          calculation, since the in-progress total would make the calculation
          less accurate.
        </p>
        <p>
          You can come back next month, or you can add some historical data for
          past months. You can also bulk upload data via CSV files from the
          <a href="/settings">settings</a> page, which may speed things up.
        </p>
      `;
      runwayBlock.removeAttribute('hidden');
      return;
    }

    const currentSavings = totalSavingsByMonth[totalSavingsByMonth.length - 1]?.total;
    if (!currentSavings) {
      runwayBlock.innerHTML += `
        <p>
          We don't have enough savings data to calculate what your runway might
          be. All we need is one month of savings, so if you track what's
          currently in your savings or retirement accounts (or even cash), we'll
          be able to calculate your runway.
        </p>
      `;
      runwayBlock.removeAttribute('hidden');
      return;
    }

    const averageRecentExpenses = recentExpenses.reduce((acc, e) => (acc + e.total), 0) / recentExpenses.length;
    const runwayInMonths = Math.floor(currentSavings / averageRecentExpenses);

    runwayBlock.innerHTML += runwayDescription(runwayInMonths, recentExpenses.length);
    runwayBlock.removeAttribute('hidden');
  };

  const yearsToRetirement = (assets, yearlySavings, amountNeeded, interest = 0.07) => {
    let count = 0;
    while (amountNeeded > assets) {
      assets = (assets + yearlySavings) * (1 + interest);
      count += 1;
      if (count > 99) {
        break;
      }
    }

    return count;
  };

  const calculateRetirementEstimates = (totalExpensesByMonth, totalIncomeByMonth, totalSavingsByMonth) => {
    const retirementBlock = document.querySelector('[data-retirement]');
    const retirementAmountBlock = document.querySelector('[data-retirement-amount]');
    const retirementYearsBlock = document.querySelector('[data-retirement-years]');

    const recentExpenses = totalExpensesByMonth.slice(-13, -1);
    if (!recentExpenses.length) {
      retirementAmountBlock.innerHTML = `
        <p>
          We don't have enough expenses data to calculate how much you might
          need to retire. As a rule, we don't factor in the current month for
          this calculation, since the in-progress total would make the
          calculation less accurate.
        </p>
        <p>
          You can come back next month, or you can add some historical data for
          past months. You can also bulk upload data via CSV files from the
          <a href="/settings">settings</a> page, which may speed things up.
        </p>
      `;

      retirementBlock.removeAttribute('hidden');
      return;
    }

    const averageRecentExpenses = recentExpenses.reduce((acc, e) => (acc + e.total), 0) / recentExpenses.length;
    const estimatedYearlyExpenses = averageRecentExpenses * 12;
    const estimatedRetirementAmount = estimatedYearlyExpenses * 25;

    const recentIncome = totalIncomeByMonth.slice(-13, -1);
    if (!recentIncome.length) {
      retirementYearsBlock.innerHTML = `
        <p>
          We don't have enough income data to calculate how long it might take
          to retire. As a rule, we don't factor in the current month for this
          calculation, since the in-progress total would make the calculation
          less accurate.
        </p>
        <p>
          You can come back next month, or you can add some historical data for
          past months. You can also bulk upload data via CSV files from the
          <a href="/settings">settings</a> page, which may speed things up.
        </p>
      `;
      retirementBlock.removeAttribute('hidden');
      return;
    }

    const currentSavings = totalSavingsByMonth[totalSavingsByMonth.length - 1]?.total;
    if (!currentSavings) {
      retirementYearsBlock.innerHTML += `
        <p>
          We don't have enough savings data to calculate how long it might take
          to retire. All we need is one month of savings, so if you track what's
          currently in your savings or retirement accounts (or even cash), we'll
          be able to calculate how long you might have until retirement.
        </p>
      `;
      retirementBlock.removeAttribute('hidden');
      return;
    }

    const averageRecentIncome = recentIncome.reduce((acc, i) => (acc + i.total), 0) / recentIncome.length;
    const estimatedYearlyIncome = averageRecentIncome * 12;
    const estimatedAnnualSavings = estimatedYearlyIncome - estimatedYearlyExpenses;

    const estimatedYearsToRetirement = yearsToRetirement(currentSavings, estimatedAnnualSavings, estimatedRetirementAmount);

    retirementAmountBlock.innerHTML = `
      <p>
        Based on your average expenses over the past
        ${recentExpenses.length === 1 ? 'month' : `${recentExpenses.length} months`},
        we estimate that you will need at least
        <b>${formatCurrency(estimatedRetirementAmount)}</b>
        to retire safely.
      </p>
    `;

    retirementYearsBlock.innerHTML = `
      ${estimatedYearsToRetirement > 99
        ? `
          <p>
            Based on your current savings and expenses, it is highly unlikely
            that you will be able to save enough money to retire. This means
            that you're either spending more money than you make, or it means
            that you aren't saving enough to meaningfully grow your retirement
            savings.
          </p>
          <p>
            You might want to consider finding a financial advisor, but make
            sure you ask them if they are a fiduciary and whether they get paid
            through a fee-only model. If they answer no to either question, find
            somebody else to help.
          </p>
        `
        : `
          <p>
            Based on how much you save per year (income minus expenses), we
            estimate that it will take about
            <b>
              ${estimatedYearsToRetirement === 1 ? '1 year' : `${estimatedYearsToRetirement} years`}
            </b>
            for you to have enough saved to retire.
          </p>
        `}
      <p>
        If those numbers seem impossibly large, the best way to make them
        smaller is to reduce your average expenses. We recommend that instead of
        focusing on minor luxury expenses (the so-called "latte factor"), you
        start with your largest expenses and see what you can do to make them
        smaller.
      </p>
      <p>
        Making more money also helps, but there's no actionable advice for doing
        that. Changes such as shopping around for better insurance, finding
        cheaper housing, and using public transportation, bikes, or cheap used
        cars instead of driving new, rapidly depreciating cars are more within
        reach.
      </p>
    `;

    retirementBlock.removeAttribute('hidden');
  };

  (async () => {
    const allExpenses = await getAllFromObjectStore('expenses');
    const expensesByMonth = allExpenses.reduce((acc, expense) => {
      if (acc[`${formatMonthString(expense.year, expense.month)}`]) {
        acc[`${formatMonthString(expense.year, expense.month)}`].push(expense);
      } else {
        acc[`${formatMonthString(expense.year, expense.month)}`] = [expense];
      }

      return acc;
    }, {});

    const totalExpensesByMonth = Object.keys(expensesByMonth)
      .map((key) => ({
        year: expensesByMonth[key][0].year,
        month: expensesByMonth[key][0].month,
        label: key,
        total: expensesByMonth[key].reduce((acc, expense) => (acc + expense.amount), 0),
      }))
      .sort(sortingFunction);

    const allIncome = await getAllFromObjectStore('income');
    const incomeByMonth = allIncome.reduce((acc, income) => {
      if (acc[`${formatMonthString(income.year, income.month)}`]) {
        acc[`${formatMonthString(income.year, income.month)}`].push(income);
      } else {
        acc[`${formatMonthString(income.year, income.month)}`] = [income];
      }

      return acc;
    }, {});

    const totalIncomeByMonth = Object.keys(incomeByMonth)
      .map((key) => ({
        year: incomeByMonth[key][0].year,
        month: incomeByMonth[key][0].month,
        label: key,
        total: incomeByMonth[key].reduce((acc, income) => (acc + income.amount), 0),
      }))
      .sort(sortingFunction);

    const allSavings = await getAllFromObjectStore('savings');
    const savingsByMonth = allSavings.reduce((acc, savings) => {
      if (acc[`${formatMonthString(savings.year, savings.month)}`]) {
        acc[`${formatMonthString(savings.year, savings.month)}`].push(savings);
      } else {
        acc[`${formatMonthString(savings.year, savings.month)}`] = [savings];
      }

      return acc;
    }, {});

    const totalSavingsByMonth = Object.keys(savingsByMonth)
      .map((key) => ({
        year: savingsByMonth[key][0].year,
        month: savingsByMonth[key][0].month,
        label: key,
        total: savingsByMonth[key].reduce((acc, savings) => (acc + savings.amount), 0),
      }))
      .sort(sortingFunction);

    calculateRunway(totalExpensesByMonth, totalSavingsByMonth);
    calculateRetirementEstimates(totalExpensesByMonth, totalIncomeByMonth, totalSavingsByMonth);
  })();
</script>
